function pointFromOrigin(e,i){return new Vector2(e.x-i.x,e.y-i.y)}function distance(e,i){return Math.sqrt(Math.pow(e.x-i.x,2)+Math.pow(e.y-i.y,2))}function angleToVector(e){return new Vector2(Math.cos(e/180*Math.PI),Math.sin(e/180*Math.PI))}function vectorToAngle(e){return Math.atan2(e.y,e.x)}function random(e,i){return Math.round(Math.random()*(i-e)+e)}class Vector2{constructor(e,i){this.x=e,this.y=i}add(e){this.x+=e.x,this.y+=e.y}substract(e){this.x-=e.x,this.y-=e.y}multiply(e){this.x*=e.x,this.y*=e.y}divide(e){this.x/=e.x,this.y/=e.y}dot(e){return this.x*e.x+this.y*e.y}sum(){return this.x+this.y}}Array.prototype.pickRandom=function(){return this[Math.floor(Math.random()*this.length)]};const exampleInfoForObject={type:"fill",color:"white",background:!1,text:"Hello, World!",size:17,autoRemove:!1,velocity:new Vector2(0,0),image:new Image,multiplyGravity:1,bounce:0,whenHit:function(e){},click:function(e){}};var scene={_dynamic:[],_static:[],_ui:[],_lastDraw:(new Date).getTime(),_guid:0,_loaded:!1,_oldviewSize:new Vector2(window.innerWidth,window.innerHeight),viewSize:new Vector2(window.innerWidth,window.innerHeight),_resize(){this.ctx.translate(-this._oldviewSize.x/2,-this._oldviewSize.y/2),this.ctx.canvas.width=window.innerWidth,this.ctx.canvas.height=window.innerHeight,this.ctx.translate(window.innerWidth/2,window.innerHeight/2),this._oldviewSize=new Vector2(window.innerWidth,window.innerHeight),this.viewSize=new Vector2(window.innerWidth,window.innerHeight)},input:{horizontal:0,vertical:0,key:{},mousePosition:new Vector2(0,0)},_shakeX:0,_shakeY:0,backgroundColor(e){scene.ctx.canvas.style.backgroundColor=e},cameraPosition:new Vector2(0,0),_shake(){if(scene._shakeIntensity>0){var e=((new Date).getTime()-scene._shakeStart)/scene._shakeDuration;e>1?(scene._shakeStart=0,scene._shakeDuration=0,scene._shakeIntensity=0,scene._shakeX=0,scene._shakeY=0):(scene._shakeX=(2*Math.random()-1)*scene._shakeIntensity*(1-e),scene._shakeY=(2*Math.random()-1)*scene._shakeIntensity*(1-e))}else scene._shakeX=0,scene._shakeY=0;scene._shakeX-=scene.cameraPosition.x,scene._shakeY-=scene.cameraPosition.y},_update(){var e=0;(scene.input.key.a||scene.input.key.ArrowLeft)&&(e-=1),(scene.input.key.d||scene.input.key.ArrowRight)&&(e+=1);var i=0;(scene.input.key.s||scene.input.key.ArrowDown)&&(i-=1),(scene.input.key.w||scene.input.key.ArrowUp)&&(i+=1),scene.input.horizontal=.9*scene.input.horizontal+.1*e,scene.input.vertical=.9*scene.input.vertical+.1*i;var n=(new Date).getTime(),s=(n-scene._lastDraw)/1e3;scene._physics(s),scene._shake();try{scene.update(s),requestAnimationFrame(scene._update)}catch(e){console.error(e)}scene._removeDynamicsOutsideScreen(),scene._draw(),scene._lastDraw=n},_removeDynamicsOutsideScreen(){for(var e=scene._dynamic.length-1;e>-1;e--)if(scene._dynamic[e].info.autoRemove){var i=scene._dynamic[e],n=i.position.x+scene._shakeX-i.size.x/2,s=i.position.y+scene._shakeY-i.size.y/2,t=i.position.x+scene._shakeX+i.size.x/2,c=i.position.y+scene._shakeY+i.size.y/2;(t<-window.innerWidth/2||c<-window.innerHeight/2||n>window.innerWidth/2||s>window.innerHeight/2)&&scene._dynamic.splice(e,1)}},_gravityValue:9.8,physicSpeed:1,_physics(e){for(var i=scene._dynamic.length,n=0;n<i;n++){var s=scene._dynamic[n].info.multiplyGravity||1,t=new Vector2(scene._dynamic[n].info.velocity.x,scene._dynamic[n].info.velocity.y-scene._gravityValue*s*scene.physicSpeed);scene._dynamic[n].info.velocity=t,scene._static.forEach(e=>{var i=e.position.x-e.size.x/2,s=e.position.y-e.size.y/2,t=e.position.x+e.size.x/2,c=e.position.y+e.size.y/2,o=new Vector2(scene._dynamic[n].position.x,scene._dynamic[n].position.y-scene._dynamic[n].size.y/2),a=new Vector2(scene._dynamic[n].position.x,scene._dynamic[n].position.y+scene._dynamic[n].size.y/2),r=new Vector2(scene._dynamic[n].position.x-scene._dynamic[n].size.x/2,scene._dynamic[n].position.y),y=new Vector2(scene._dynamic[n].position.x+scene._dynamic[n].size.x/2,scene._dynamic[n].position.y);if(o.x>i&&o.x<t&&o.y>s&&o.y<c||a.x>i&&a.x<t&&a.y>s&&a.y<c||r.x>i&&r.x<t&&r.y>s&&r.y<c||y.x>i&&y.x<t&&y.y>s&&y.y<c){var d=new Vector2(Math.round((e.position.x-scene._dynamic[n].position.x)/scene._dynamic[n].size.x),Math.round((e.position.y-scene._dynamic[n].position.y)/scene._dynamic[n].size.y));d.multiply(new Vector2(e.info.bounce||1,e.info.bounce||1)),scene._dynamic[n].info.velocity.multiply(d||new Vector2(1,1)),scene._dynamic[n].info.whenHit&&scene._dynamic[n].info.whenHit(e.guid),e.info.whenHit&&e.info.whenHit(scene._dynamic[n].guid)}}),scene._dynamic[n].position.add(new Vector2(scene._dynamic[n].info.velocity.x*e*scene.physicSpeed,scene._dynamic[n].info.velocity.y*e*scene.physicSpeed))}},debug:!1,afterDraw:function(){},_draw(){this.ctx.clearRect(-window.innerWidth/2,-window.innerHeight/2,window.innerWidth,window.innerHeight),scene._ui.filter(e=>e.info.background).forEach(e=>{if("fill"==e.info.type?(this.ctx.fillStyle=e.info.color,this.ctx.fillRect(e.position.x+scene._shakeX-e.size.x/2,-(e.position.y+scene._shakeY)-e.size.y/2,e.size.x,e.size.y)):"text"==e.info.type?(this.ctx.fillStyle=e.info.color,this.ctx.font=`${e.info.size||15}px Arial`,this.ctx.fillText(e.info.text,e.position.x+scene._shakeX,-(e.position.y+scene._shakeY))):"image"==e.info.type&&this.ctx.drawImage(e.info.image,e.position.x+scene._shakeX-e.size.x/2,-(e.position.y+scene._shakeY)-e.size.y/2,e.size.x,e.size.y),scene.debug){var i=scene.ctx.strokeStyle;scene.ctx.strokeStyle="red",this.ctx.strokeRect(e.position.x+scene._shakeX-e.size.x/2,-(e.position.y+scene._shakeY)-e.size.y/2,e.size.x,e.size.y),scene.ctx.strokeStyle=i}}),scene._static.forEach(e=>{if("fill"==e.info.type?(this.ctx.fillStyle=e.info.color,this.ctx.fillRect(e.position.x+scene._shakeX-e.size.x/2,-(e.position.y+scene._shakeY)-e.size.y/2,e.size.x,e.size.y)):"text"==e.info.type?(this.ctx.fillStyle=e.info.color,this.ctx.font=`${e.info.size||15}px Arial`,this.ctx.fillText(e.info.text,e.position.x+scene._shakeX,-(e.position.y+scene._shakeY))):"image"==e.info.type&&this.ctx.drawImage(e.info.image,e.position.x+scene._shakeX-e.size.x/2,-(e.position.y+scene._shakeY)-e.size.y/2,e.size.x,e.size.y),scene.debug){var i=scene.ctx.strokeStyle;scene.ctx.strokeStyle="red",this.ctx.strokeRect(e.position.x+scene._shakeX-e.size.x/2,-(e.position.y+scene._shakeY)-e.size.y/2,e.size.x,e.size.y),scene.ctx.strokeStyle=i}}),scene._dynamic.forEach(e=>{if("fill"==e.info.type?(this.ctx.fillStyle=e.info.color,this.ctx.fillRect(e.position.x+scene._shakeX-e.size.x/2,-(e.position.y+scene._shakeY)-e.size.y/2,e.size.x,e.size.y)):"text"==e.info.type?(this.ctx.fillStyle=e.info.color,this.ctx.font=`${e.info.size||15}px Arial`,this.ctx.fillText(e.info.text,e.position.x+scene._shakeX,-(e.position.y+scene._shakeY))):"image"==e.info.type&&this.ctx.drawImage(e.info.image,e.position.x+scene._shakeX-e.size.x/2,-(e.position.y+scene._shakeY)-e.size.y/2,e.size.x,e.size.y),scene.debug){var i=scene.ctx.strokeStyle;scene.ctx.strokeStyle="red",this.ctx.strokeRect(e.position.x+scene._shakeX-e.size.x/2,-(e.position.y+scene._shakeY)-e.size.y/2,e.size.x,e.size.y),scene.ctx.strokeStyle=i}}),scene._ui.filter(e=>!e.info.background).forEach(e=>{if("fill"==e.info.type?(this.ctx.fillStyle=e.info.color,this.ctx.fillRect(e.position.x+scene._shakeX-e.size.x/2,-(e.position.y+scene._shakeY)-e.size.y/2,e.size.x,e.size.y)):"text"==e.info.type?(this.ctx.fillStyle=e.info.color,this.ctx.font=`${e.info.size||15}px Arial`,this.ctx.fillText(e.info.text,e.position.x+scene._shakeX,-(e.position.y+scene._shakeY))):"image"==e.info.type&&this.ctx.drawImage(e.info.image,e.position.x+scene._shakeX-e.size.x/2,-(e.position.y+scene._shakeY)-e.size.y/2,e.size.x,e.size.y),scene.debug){var i=scene.ctx.strokeStyle;scene.ctx.strokeStyle="red",this.ctx.strokeRect(e.position.x+scene._shakeX-e.size.x/2,-(e.position.y+scene._shakeY)-e.size.y/2,e.size.x,e.size.y),scene.ctx.strokeStyle=i}}),scene.afterDraw()},update:function(e){},start:function(){},ctx:void 0,add:{dynamic(e,i,n){if(null==n.velocity){var s=n;s.velocity=new Vector2(0,0),scene._dynamic.push({position:e,size:i,guid:scene._guid,info:s})}else scene._dynamic.push({position:e,size:i,guid:scene._guid,info:n});return scene._guid++},static:(e,i,n)=>(scene._static.push({position:e,size:i,guid:scene._guid,info:n}),scene._guid++),ui:(e,i,n)=>(scene._ui.push({position:e,size:i,guid:scene._guid,info:n}),scene._guid++)},setVelocity(e,i){for(var n=0;n<scene._dynamic.length;n++)scene._dynamic[n].guid==e&&(scene._dynamic[n].info.velocity=i)},setPosition(e,i){for(var n=0;n<scene._dynamic.length;n++)scene._dynamic[n].guid==e&&(scene._dynamic[n].position=i);for(n=0;n<scene._static.length;n++)scene._static[n].guid==e&&(scene._static[n].position=i);for(n=0;n<scene._ui.length;n++)scene._ui[n].guid==e&&(scene._ui[n].position=i)},setSize(e,i){for(var n=0;n<scene._dynamic.length;n++)scene._dynamic[n].guid==e&&(scene._dynamic[n].size=i);for(n=0;n<scene._static.length;n++)scene._static[n].guid==e&&(scene._static[n].size=i);for(n=0;n<scene._ui.length;n++)scene._ui[n].guid==e&&(scene._ui[n].size=i)},getSize(e){for(var i=0;i<scene._dynamic.length;i++)if(scene._dynamic[i].guid==e)return scene._dynamic[i].size;for(i=0;i<scene._static.length;i++)if(scene._static[i].guid==e)return scene._static[i].size;for(i=0;i<scene._ui.length;i++)if(scene._ui[i].guid==e)return scene._ui[i].size},movePosition(e,i){for(var n=0;n<scene._dynamic.length;n++)scene._dynamic[n].guid==e&&scene._dynamic[n].position.add(i);for(n=0;n<scene._static.length;n++)scene._static[n].guid==e&&scene._static[n].position.add(i);for(n=0;n<scene._ui.length;n++)scene._ui[n].guid==e&&scene._ui[n].position.add(i)},remove(e,i){setTimeout(()=>{for(var n=scene._dynamic.length-1;n>-1;n--)scene._dynamic[n].guid==e&&scene._dynamic.splice(n,1);for(n=scene._static.length-1;n>-1;n--)scene._static[n].guid==e&&scene._static.splice(n,1);for(n=scene._ui.length-1;n>-1;n--)scene._ui[n].guid==e&&scene._ui.splice(n,1);i&&i()},0)},removeAll(e){setTimeout(()=>{scene._dynamic=[],scene._static=[],scene._ui=[],e()},0)},getPosition(e){for(var i=scene._dynamic.length-1;i>-1;i--)if(scene._dynamic[i].guid==e)return scene._dynamic[i].position;for(i=scene._static.length-1;i>-1;i--)if(scene._static[i].guid==e)return scene._static[i].position;for(i=scene._ui.length-1;i>-1;i--)if(scene._ui[i].guid==e)return scene._ui[i].position},getVelocity(e){for(var i=scene._dynamic.length-1;i>-1;i--)if(scene._dynamic[i].guid==e)return scene._dynamic[i].info.velocity},getInfo(e){for(var i=scene._dynamic.length-1;i>-1;i--)if(scene._dynamic[i].guid==e)return scene._dynamic[i].info;for(i=scene._static.length-1;i>-1;i--)if(scene._static[i].guid==e)return scene._static[i].info;for(i=scene._ui.length-1;i>-1;i--)if(scene._ui[i].guid==e)return scene._ui[i].info},setInfo(e,i){for(var n=scene._dynamic.length-1;n>-1;n--)scene._dynamic[n].guid==e&&(scene._dynamic[n].info=i);for(n=scene._static.length-1;n>-1;n--)scene._static[n].guid==e&&(scene._static[n].info=i);for(n=scene._ui.length-1;n>-1;n--)scene._ui[n].guid==e&&(scene._ui[n].info=i)},setInfoProperty(e,i,n){for(var s=scene._dynamic.length-1;s>-1;s--)scene._dynamic[s].guid==e&&(scene._dynamic[s].info[i]=n);for(s=scene._static.length-1;s>-1;s--)scene._static[s].guid==e&&(scene._static[s].info[i]=n);for(s=scene._ui.length-1;s>-1;s--)scene._ui[s].guid==e&&(scene._ui[s].info[i]=n)},exists(e){for(var i=scene._dynamic.length-1;i>-1;i--)if(scene._dynamic[i].guid==e)return!0;for(i=scene._static.length-1;i>-1;i--)if(scene._static[i].guid==e)return!0;for(i=scene._ui.length-1;i>-1;i--)if(scene._ui[i].guid==e)return!0;return!1},_shakeStart:0,_shakeDuration:0,_shakeIntensity:0,shake(e,i){scene._shakeStart=(new Date).getTime(),scene._shakeDuration=1e3*e,scene._shakeIntensity=i}};window.addEventListener("keydown",e=>{scene.input.key[e.key]=!0}),window.addEventListener("keyup",e=>{delete scene.input.key[e.key]}),window.addEventListener("load",()=>{scene._loaded=!0;var e=document.createElement("canvas");e.width=window.innerWidth,e.height=window.innerHeight,e.style.imageRendering="pixelated",e.style.position="fixed",e.style.left="0",e.style.top="0",e.style.backgroundColor="black",document.body.appendChild(e),scene.ctx=e.getContext("2d"),scene.ctx.imageSmoothingEnabled=!1,scene.ctx.translate(window.innerWidth/2,window.innerHeight/2),scene.ctx.fillStyle="white",scene.ctx.strokeStyle="white",scene.ctx.textAlign="center",scene.start(),scene._draw(),requestAnimationFrame(scene._update)}),window.addEventListener("contextmenu",e=>e.preventDefault()),window.addEventListener("resize",()=>{scene._resize()}),window.addEventListener("mousedown",e=>{e.preventDefault();var i=["left","middle","right"],n=new Vector2(e.clientX-scene._oldviewSize.x/2,-(e.clientY-scene._oldviewSize.y/2));scene._dynamic.forEach(s=>{var t=s.position.x+scene._shakeX-s.size.x/2,c=s.position.y+scene._shakeY-s.size.y/2,o=s.position.x+scene._shakeX+s.size.x/2,a=s.position.y+scene._shakeY+s.size.y/2;n.x>t&&n.x<o&&n.y>c&&n.y<a&&s.click&&s.click(i[e.button])}),scene._static.forEach(s=>{var t=s.position.x+scene._shakeX-s.size.x/2,c=s.position.y+scene._shakeY-s.size.y/2,o=s.position.x+scene._shakeX+s.size.x/2,a=s.position.y+scene._shakeY+s.size.y/2;n.x>t&&n.x<o&&n.y>c&&n.y<a&&s.click&&s.click(i[e.button])}),scene._ui.forEach(s=>{var t=s.position.x+scene._shakeX-s.size.x/2,c=s.position.y+scene._shakeY-s.size.y/2,o=s.position.x+scene._shakeX+s.size.x/2,a=s.position.y+scene._shakeY+s.size.y/2;n.x>t&&n.x<o&&n.y>c&&n.y<a&&s.info.click&&s.info.click(i[e.button])})},!1),function(){function e(e){var i,n,s;e=e||window.event,null==e.pageX&&null!=e.clientX&&(i=e.target&&e.target.ownerDocument||document,n=i.documentElement,s=i.body,e.pageX=e.clientX+(n&&n.scrollLeft||s&&s.scrollLeft||0)-(n&&n.clientLeft||s&&s.clientLeft||0),e.pageY=e.clientY+(n&&n.scrollTop||s&&s.scrollTop||0)-(n&&n.clientTop||s&&s.clientTop||0)),scene.input.mousePosition=new Vector2(e.pageX-window.innerWidth/2,-(e.pageY-window.innerHeight/2))}document.onmousemove=e}();